---
import type { ButtonProps } from "../types/directus";
import dayjs from "../utils/dayjs";
import Button from "./Button.astro";

interface NewsCardsProps {
  title: string;
  description: string;
  image: {
    id: string;
    description: string;
  };
  publication_date: string;
  category: string;
  pdf_file?: string;
  button_link?: ButtonProps[];
  headingLevel?: "h2" | "h3";
}

const {
  title,
  description,
  image: { id, description: alt },
  publication_date,
  category,
  pdf_file,
  button_link = [],
  headingLevel: _headingLevel = "h3",
} = Astro.props as NewsCardsProps;

const headingLevel: "h2" | "h3" =
  _headingLevel === "h2" || _headingLevel === "h3" ? _headingLevel : "h3";
const HeadingTag = headingLevel;

const DIRECTUS_BASE = import.meta.env.PUBLIC_DIRECTUS_URL;
---

<div class="news-card">
  <img
    src={`${DIRECTUS_BASE}/assets/${id}?width=720&height=720&format=webp`}
    alt={alt}
    width="720"
    height="720"
    loading="lazy"
    decoding="async"
  />

  <p class="news-category">{category}</p>
  <p class="news-publication-date">
    {dayjs(publication_date).format("MMMM YYYY")}
  </p>
  <HeadingTag class="news-title">{title}</HeadingTag>
  <p class="news-description">{description}</p>
  {
    (pdf_file || button_link?.[0]?.item?.href) && (
      <Button
        variant="secondary"
        href={
          pdf_file
            ? `${DIRECTUS_BASE}/assets/${pdf_file}`
            : button_link?.[0]?.item?.href
        }
        iconPosition="right"
        iconName={pdf_file ? "download" : "extra_link"}
        class="see-news-btn"
      >
        {pdf_file
          ? "Consulter le PDF"
          : (button_link?.[0]?.item?.label ?? "Accéder à l'article")}
      </Button>
    )
  }
</div>

<style lang="scss">
  @use "../styles/abstracts";

  .news-card {
    img {
      height: auto;
    }

    .news-category {
      @include abstracts.typography(abstracts.$font-paragraph, 20px, 32px, 700);
      color: abstracts.$color-blue-tint-1;
      text-transform: uppercase;
      margin-top: abstracts.rem(8px);
    }

    .news-publication-date {
      text-transform: capitalize;
      margin-top: abstracts.rem(8px);
    }

    .news-title {
      margin-block: abstracts.rem(8px);
      @include abstracts.typography(abstracts.$font-title, 20px, 24px, 700);
    }

    .see-news-btn {
      margin-top: abstracts.rem(20px);
      width: 100%;
    }
  }
</style>
